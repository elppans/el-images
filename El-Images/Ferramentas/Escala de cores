#!/bin/bash

# Opções de espaço de cores
color_space=$(zenity --list --title="Escolher Espaço de Cores" \
    --text="Selecione o espaço de cores para conversão:" \
    --column="Espaço de Cores" \
    "Gray (Escala de Cinza)" \
    "RGB" \
    "CMYK" \
    "LAB" \
    "YCbCr" \
    --height=250)

# Verifica se o usuário cancelou
if [ -z "$color_space" ]; then
    exit 1
fi

# Mapeia a opção selecionada para o formato correto do ImageMagick
case "$color_space" in
    "Gray (Escala de Cinza)") convert_space="Gray" ;;
    "RGB") convert_space="sRGB" ;;
    "CMYK") convert_space="CMYK" ;;
    "LAB") convert_space="Lab" ;;
    "YCbCr") convert_space="YCbCr" ;;
    *) zenity --error --text="Erro: Espaço de cores inválido."; exit 1 ;;
esac

# Diretório de saída
output_dir="$HOME/Imagens/Convertidas"

# Cria o diretório de saída, se não existir
mkdir -p "$output_dir"

# Arquivo de log
log_file="/tmp/converter_escala_de_cores.log"
echo "Espaço de cores escolhido: $convert_space" > "$log_file"
echo "Arquivos: $@" >> "$log_file"
echo "Diretório de saída: $output_dir" >> "$log_file"

# Processa os arquivos selecionados
for file in "$@"; do
    if [[ -f "$file" ]]; then
        filename=$(basename "$file")
        output_file="$output_dir/$filename"

        # Converte o espaço de cores
        convert "$file" -colorspace "$convert_space" "$output_file"

        if [ $? -eq 0 ]; then
            echo "Convertido: $file -> $output_file ($convert_space)" >> "$log_file"
        else
            echo "Erro ao converter: $file" >> "$log_file"
            zenity --error --text="Erro ao converter: $file. Verifique o log em $log_file."
        fi
    fi
done

zenity --info --text="Conversão concluída! Arquivos salvos em: $output_dir"
